cmake_minimum_required(VERSION 3.10)

project(ytbpf_resources)

set(LIBBPF_DIR ${CMAKE_CURRENT_SOURCE_DIR}/libbpf)

file (GLOB LIBBPF_SOURCES ${LIBBPF_DIR}/src/*.[hc])
message("SOURCES: ${LIBBPF_SOURCES}")

add_custom_target(libbpf
    WORKING_DIRECTORY ${LIBBPF_DIR}
    DEPENDS ${LIBBPF_SOURCES}
    COMMENT "build static libbpf libary"
    COMMENT "make -C ${LIBBPF_DIR}/src BUILD_STATIC_ONLY=1 OBJDIR=${CMAKE_CURRENT_BINARY_DIR}/libbpf DESTDIR=${CMAKE_CURRENT_BINARY_DIR} INCLUDEDIR= LIBDIR= UAPIDIR= -j22 install"
    COMMAND make -C ${LIBBPF_DIR}/src BUILD_STATIC_ONLY=1 OBJDIR=${CMAKE_CURRENT_BINARY_DIR}/libbpf DESTDIR=${CMAKE_CURRENT_BINARY_DIR} INCLUDEDIR= LIBDIR= UAPIDIR= -j22 install
)
